<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title layout:title-pattern="$CONTENT_TITLE - $LAYOUT_TITLE">Ayurvedic Diet Manager</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">

    <style>
        /* Bigger Chatbot Window */
        #chatbot-window {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 500px;   /* Increased width */
            height: 600px;  /* Increased height */
            background: white;
            border: 1px solid #ddd;
            border-radius: 12px;
            display: none;
            flex-direction: column;
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
            z-index: 999999;
        }

        #chatbot-window header {
            background: #4caf50;
            color: white;
            padding: 12px;
            border-radius: 12px 12px 0 0;
            font-weight: bold;
            font-size: 16px;
        }

        #chat-messages {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            font-size: 14px;
        }

        #chat-input {
            flex: 1;
            border: none;
            padding: 12px;
            outline: none;
            font-size: 14px;
        }

        #send-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 12px 16px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div th:replace="fragments/header :: header"></div>
    
    <!-- Main Content -->
    <main>
        <div layout:fragment="content"></div>
    </main>
    
    <!-- Footer -->
    <div th:replace="fragments/footer :: footer"></div>
    
    <script th:src="@{/js/script.js}"></script>
    <div layout:fragment="scripts"></div>

    <!-- Chat Window -->
    <div id="chatbot-window">
        <header>Ayurveda Chatbot</header>
        <div id="chat-messages"></div>
        <div style="display:flex;">
            <input id="chat-input" type="text" placeholder="Ask me anything...">
            <button id="send-btn">Send</button>
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const chatbotNavBtn = document.getElementById("chatbot-nav-btn");
        const chatbotWindow = document.getElementById("chatbot-window");
        const chatMessages = document.getElementById("chat-messages");
        const chatInput = document.getElementById("chat-input");
        const sendBtn = document.getElementById("send-btn");

        if (chatbotNavBtn) {
            chatbotNavBtn.onclick = () => {
                chatbotWindow.style.display = chatbotWindow.style.display === "none" ? "flex" : "none";
            };
        }

        sendBtn.onclick = async () => {
            const question = chatInput.value.trim();
            if (!question) return;

            chatMessages.innerHTML += `<div style='text-align:right;margin:5px 0;'><b>You:</b> ${question}</div>`;
            chatInput.value = "";

            try {
                const res = await fetch("/api/chat/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: question })
                });
                const data = await res.json();
                chatMessages.innerHTML += `<div style='text-align:left;color:#4caf50;margin:5px 0;'><b>Bot:</b> ${data.reply}</div>`;
            } catch {
                chatMessages.innerHTML += `<div style='text-align:left;color:#4caf50;margin:5px 0;'><b>Bot:</b> Sorry, Iâ€™m offline.</div>`;
            }
            chatMessages.scrollTop = chatMessages.scrollHeight;
        };
    });
    </script>
</body>
</html>
